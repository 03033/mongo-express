{% extends 'layout.html' %}

{% block title %}{{ collectionName }}{% endblock %}


{% block head %}
  <link href="stylesheets/codemirror.css" rel="stylesheet">
  <script type="text/javascript" src="javascripts/codemirror-compressed.js"></script>

  {% if editorTheme != "default" %}
  <link href="stylesheets/theme/{{ editorTheme }}.css" rel="stylesheet">
  {% endif %}

  <style type="text/css">
    .CodeMirror-scroll {
      height: 120px;
      overflow: auto;
    }
  </style>
{% endblock %}


{% block breadcrumb %}
  <li>
    <a href="">Home</a>
    <span class="divider">/</span>
  </li>
  <li>
    <a href="/db/{{ dbName }}">{{ dbName }}</a>
    <span class="divider">/</span>
  </li>
  <li class="active">
    {{ collectionName }}
  </li>
{% endblock %}


{% block content %}

{% if documents.length == 0 %}
<p class="well">
No documents found.
</p>
{% else %}

{% if collectionName != 'system.indexes' %}
<script type="text/javascript">
function loadDocument(id) {
  location.href = '{{ baseHref }}db/{{ dbName }}/{{ collectionName }}/' + id;
}
</script>
{% endif %}

{% for document in documents %}
<div class="row">
<div class="span8">
  <textarea readonly="readonly" id="doc_{{ loop.index }}" name="doc_{{ loop.index }}">{{ document|json }}</textarea>
  <p>&nbsp;</p>

  <script>
    var doc = CodeMirror.fromTextArea(document.getElementById('doc_{{ loop.index }}'), {
      mode: { name: "javascript", json: true },
      readOnly: true,
      indentUnit: 4,
      autoClearEmptyLines: true,
      matchBrackets: true,
      theme: "{{ editorTheme }}",
      lineNumbers: true
      {%- if collectionName != 'system.indexes' %},
      onFocus: function() { loadDocument('{{ document._id }}') }
      {%- endif %}
    });
  </script>
</div>
<div class="span1">
  <br /><br />
  <form method="POST" action="db/{{ dbName }}/{{ collectionName }}/{{ document._id }}">
  <input type="hidden" name="_method" value="delete">
  <button type="submit" class="btn btn-danger btn-mini">
  <i class="icon-remove icon-white"></i>
  </button>
  </form>
</div>
</div>
{% endfor %}

{% endif %}


{#
  # Not very useful, since it doesn't show correct index names
  # Could use db.coll.getIndexes(), but that is an extra query on every collection page
<h2>Indexes</h2>
{% if stats.nindexes == 0 %}
<p class="well">
No indexes found.
</p>
{% else %}
<table class="table table-bordered table-striped">
  {% for size in stats.indexSizes %}
  <tr>
    <td>{{ loop.key }}</td>
    <td>{{ size }} bytes</td>
  </tr>
  {% endfor %}
</table>
{% endif %}
#}

<div class="row">
<div class="span5">

<h2>Rename Collection</h2>
<form method="POST" action="db/{{ dbName }}/{{ collectionName }}" class="well form-inline">
  <input type="hidden" name="_method" value="put">
  <div class="input-prepend">
    <span class="add-on">{{ dbName }} . </span>
    <input class="input-medium" type="text" id="collection" name="collection" placeholder="{{ collectionName }}">
  </div>
  <button type="submit" class="btn btn-primary">
  <i class="icon-tag icon-white"></i>
  Rename
  </button>
</form>

</div>
<div class="span4">

<h2>Delete Collection</h2>
<form method="POST" action="db/{{ dbName }}/{{ collectionName }}" class="well">
  <input type="hidden" name="_method" value="delete">
  <p>Are you sure you want to delete this collection? All documents will be deleted.</p>
  <button type="submit" class="btn btn-danger">
  <i class="icon-trash icon-white"></i>
  Delete
  </button>
</form>

</div>

{% endblock %}



{% block sidebar %}
  <div class="sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">Collection Stats</li>
      <li>
        <strong>Documents</strong>
        <span class="pull-right" id="collStatsCount">{{ stats.count }}</span>
      </li>
      <li>
        <strong>Total doc size</strong>
        <span class="pull-right">{{ stats.size }} bytes</span>
      </li>
      <li>
        <strong>Average doc size</strong>
        <span class="pull-right">{{ stats.avgObjSize }} bytes</span>
      </li>
      <li>
        <strong>Pre-allocated size</strong>
        <span class="pull-right">{{ stats.storageSize }} bytes</span>
      </li>
      <li>&nbsp;</li>
      <li>
        <strong>Indexes</strong>
        <span class="pull-right">{{ stats.nindexes }}</span>
      </li>
      <li>
        <strong>Total index size</strong>
        <span class="pull-right">{{ stats.totalIndexSize }} bytes</span>
      </li>
      <li>&nbsp;</li>
      <li>
        <strong>Padding factor</strong>
        <span class="pull-right">{{ stats.paddingFactor }}</span>
      </li>
      <li>
        <strong>Extents</strong>
        <span class="pull-right">{{ stats.numExtents }}</span>
      </li>
    </ul>
  </div>
{% endblock %}
